= OxyPlot build system

This document describes the configuration of the build server running on Team City.

== Requirements

- Visual Studio 2013
- 7-Zip in default folder

== Build parameters:

Defined under "Parameters" in the TeamCity project.

Environment variables:
- NUGET_ACCESS_KEY
- OXYPLOT_FTP_USER
- OXYPLOT_FTP_PWD
- EnableNuGetPackageRestore = true

== OxyPlot build

Build number format: 2014.1.%build.counter%.1

Artifact paths:
  Build/**/*.* => Build.zip
  Icons/**/*.* => Icons.zip
  Output/**/*.* => Output.zip
  Packages/**/*.* => Packages.zip
  Tools/**/*.* => Tools.zip
  Web/**/*.* => Web.zip

VCS root: https://hg.codeplex.com/oxyplot
  Clean all files before build

=== Build steps

# Update verison number
     Directory: Tools\Lynx
     Command: VersionUpdater.exe /Version=%build.number% /Directory=..\..
# Create changeset ID file
     mkdir Output
     echo %build.vcs.number%> Output\changeset.id
# Build WPF solution
     Solution: Source\OxyPlot.WPF.sln
     Targets: Rebuild
     Configuration: Release
# Run unit tests
     NUnit runner: NUnit 2.6.0
     Platform: auto (MSIL)
     Version: 4.0
     Run tests from: 
       Source\OxyPlot.Tests\bin\Release\OxyPlot.Tests.dll
       Source\OxyPlot.Wpf.Tests\bin\Release\OxyPlot.Wpf.Tests.dll
     Coverage: dotCover
     Filters: 
       +:OxyPlot*
       -:*.Tests*
# Build Windosw Forms solution
     Solution: Source\OxyPlot.WindowsForms.sln
     Targets: Rebuild
     Configuration: Release
# Build GTK# solution
     Solution: Source\OxyPlot.GtkSharp.sln
     Targets: Rebuild
     Configuration: Release
# Build Silverlight solution
     Solution: Source\OxyPlot.Silverlight.sln
     Targets: Rebuild
     Configuration: Release
# Build Metro solution
     Solution: Source\OxyPlot.Metro.sln
     Targets: Rebuild
     Configuration: Release
# Build Silverlight 4 solution (disabled)
     Solution: Source\OxyPlot.Silverlight4.sln
     Targets: Rebuild
     Configuration: Release
# Build Windows Forms 4.0 solution
     Solution: Source\OxyPlot.WindowsForms_NET40.sln
     Targets: Rebuild
     Configuration: Release
# Build WPF 4.0 solution
     Solution: Source\OxyPlot.WPF_NET40.sln
     Targets: Rebuild
     Configuration: Release
# Create NuGet packages
     Working directory: Build
     Command: pack.cmd 
# Generate documentation
     Working directory: build
     Commands:
       GenerateAPIDocumentation.cmd
       GenerateDocumentation.cmd
# Clean examples
     Working directory: build
     Command: DeleteExamplePdbFiles.cmd
# Create release
     Working directory: build
     Command: ZipRelease %build.number%
# Update web
     Working directory: build
     Commands:
       xcopy ..\icons\favicon.ico ..\Web /Y
       mkdir ..\Web\Examples
       xcopy ..\documentation\images\series ..\Web\Examples /Y

=== Build triggers
Triggers a build after a VCS check-in is detected


== OxyPlot Upload

Build number format: %dep.bt6.build.number%

=== Build steps

# Push packages to NuGet
     Working directory: Build
     Command: push.cmd
# Upload example browser
     Working directory: build
     Command: UploadExampleBrowser.cmd
# Upload documentation
     Working directory: build
     Command: UploadDocumentation.cmd
# Upload release
     Working directory: build
     Command: UploadRelease.cmd %build.number%
# Update web pages
     Working directory: build
     Command: UploadWeb.cmd

=== Build trigger

Wait for a successful build in: OxyPlot

=== Dependencies 

# Artifact dependency
    Source: OxyPlot
    Paths: 
      Build.zip!**=>Build
      Icons.zip!**=>Icons
      Output.zip!**=>Output
      Packages.zip!**=>Packages
      Tools.zip!**=>Tools
      Web.zip!**=>Web



